import{j as e,r as j,a as Ue,c as xt,R as ut}from"./index-CpxwhdDq.js";const P=({children:t,size:n=24,className:r="",...x})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:r,...x,children:t}),pt={Settings:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),Eye:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),EyeOff:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}),e.jsx("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}),e.jsx("path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7c.44 0 .87-.03 1.28-.09"}),e.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"})]}),Plus:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5v14"})]}),Trash2:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),e.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),e.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),Move:t=>e.jsxs(P,{...t,children:[e.jsx("polyline",{points:"5 9 2 12 5 15"}),e.jsx("polyline",{points:"9 5 12 2 15 5"}),e.jsx("polyline",{points:"19 9 22 12 19 15"}),e.jsx("polyline",{points:"15 19 12 22 9 19"}),e.jsx("line",{x1:"2",x2:"22",y1:"12",y2:"12"}),e.jsx("line",{x1:"12",x2:"12",y1:"2",y2:"22"})]}),Grid3X3:t=>e.jsxs(P,{...t,children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}),e.jsx("path",{d:"M3 9h18"}),e.jsx("path",{d:"M3 15h18"}),e.jsx("path",{d:"M9 3v18"}),e.jsx("path",{d:"M15 3v18"})]}),Folder:t=>e.jsx(P,{...t,children:e.jsx("path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"})}),ChevronRight:t=>e.jsx(P,{...t,children:e.jsx("path",{d:"m9 18 6-6-6-6"})}),ChevronDown:t=>e.jsx(P,{...t,children:e.jsx("path",{d:"m6 9 6 6 6-6"})}),ChevronUp:t=>e.jsx(P,{...t,children:e.jsx("path",{d:"m18 15-6-6-6 6"})}),Palette:t=>e.jsxs(P,{...t,children:[e.jsx("circle",{cx:"13.5",cy:"6.5",r:".5"}),e.jsx("circle",{cx:"17.5",cy:"10.5",r:".5"}),e.jsx("circle",{cx:"8.5",cy:"7.5",r:".5"}),e.jsx("circle",{cx:"6.5",cy:"12.5",r:".5"}),e.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"})]}),Image:t=>e.jsxs(P,{...t,children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),e.jsx("circle",{cx:"9",cy:"9",r:"2"}),e.jsx("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}),Upload:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",x2:"12",y1:"3",y2:"15"})]}),Play:t=>e.jsx(P,{...t,children:e.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),Film:t=>e.jsxs(P,{...t,children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}),e.jsx("path",{d:"M7 3v18"}),e.jsx("path",{d:"M3 7.5h4"}),e.jsx("path",{d:"M3 12h18"}),e.jsx("path",{d:"M3 16.5h4"}),e.jsx("path",{d:"M17 3v18"}),e.jsx("path",{d:"M17 7.5h4"}),e.jsx("path",{d:"M17 16.5h4"})]}),Activity:t=>e.jsx(P,{...t,children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})}),Layers:t=>e.jsxs(P,{...t,children:[e.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),e.jsx("polyline",{points:"2 17 12 22 22 17"}),e.jsx("polyline",{points:"2 12 12 17 22 12"})]}),Workflow:t=>e.jsxs(P,{...t,children:[e.jsx("rect",{width:"8",height:"8",x:"3",y:"3",rx:"2"}),e.jsx("path",{d:"M7 11v4a2 2 0 0 0 2 2h4"}),e.jsx("rect",{width:"8",height:"8",x:"13",y:"13",rx:"2"})]}),Link:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),e.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]}),X:t=>e.jsxs(P,{...t,strokeWidth:4,stroke:"white",children:[e.jsx("path",{d:"M18 6 6 18"}),e.jsx("path",{d:"M6 6 18 18"})]}),Maximize:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}),e.jsx("path",{d:"M21 8V5a2 2 0 0 0-2-2h-3"}),e.jsx("path",{d:"M3 16v3a2 2 0 0 0 2 2h3"}),e.jsx("path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"})]}),AlertTriangle:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),e.jsx("line",{x1:"12",x2:"12",y1:"9",y2:"13"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"17",y2:"17"})]}),HardDrive:t=>e.jsxs(P,{...t,children:[e.jsx("line",{x1:"22",x2:"22",y1:"12",y2:"12"}),e.jsx("path",{d:"M2 12h20"}),e.jsx("path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"}),e.jsx("line",{x1:"6",x2:"6.01",y1:"16",y2:"16"}),e.jsx("line",{x1:"10",x2:"10.01",y1:"16",y2:"16"})]}),Database:t=>e.jsxs(P,{...t,children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),e.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),e.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),Video:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"m22 8-6 4 6 4V8Z"}),e.jsx("rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2"})]}),Blend:t=>e.jsxs(P,{...t,children:[e.jsx("circle",{cx:"9",cy:"9",r:"7"}),e.jsx("circle",{cx:"15",cy:"15",r:"7"})]}),File:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]}),FolderPlus:t=>e.jsxs(P,{...t,children:[e.jsx("path",{d:"M12 10v6M9 13h6"}),e.jsx("path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"})]})};class ht{constructor(){this.db=null,this.ready=this.init()}init(){return Promise.resolve()}async getActiveProject(){const n=await fetch("/api/project/active");return n.ok?await n.json():null}async listProjects(){const n=await fetch("/api/projects");return n.ok?await n.json():[]}async createProject(n){const r=await fetch("/api/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n})});if(!r.ok)throw new Error("Failed to create project");return await r.json()}async deleteProject(n){await fetch("/api/projects/"+encodeURIComponent(n),{method:"DELETE"})}async loadProject(n){if(!(await fetch(`/api/projects/${n}/load`,{method:"POST"})).ok)throw new Error("Failed to load project");window.location.reload()}async saveAsset(n){const r=n.name;return await fetch("/api/asset/"+encodeURIComponent(r),{method:"POST",headers:{"Content-Type":n.type,"X-Asset-Name":n.name},body:n}),r}async getAsset(n){const r=await fetch("/api/asset/"+encodeURIComponent(n));return r.ok?await r.blob():null}async getAllAssets(){const n=await fetch("/api/assets",{cache:"no-store"});return n.ok?(await n.json()).map(x=>({id:x.id,url:"/api/asset/"+encodeURIComponent(x.id),type:x.mime_type.startsWith("video")?"video":"image",file:{name:x.name}})):[]}async deleteAsset(n){await fetch("/api/asset/"+encodeURIComponent(n),{method:"DELETE"})}async saveState(n,r){await fetch("/api/kv/"+n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}async loadState(n){const r=await fetch("/api/kv/"+n);return r.ok?await r.json():null}async clearAll(){alert("Reset not fully supported in server mode yet.")}async getUsage(){return{usage:"Server",quota:"Disk"}}async listServerFiles(n=""){try{const r=await fetch(`/api/fs/list?path=${encodeURIComponent(n)}`);return r.ok?await r.json():{path:"",items:[]}}catch(r){return console.error("FS List error",r),{path:"",items:[]}}}async importAssetFromPath(n){const r=await fetch("/api/asset/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n})});if(!r.ok)throw new Error("Import failed");return await r.json()}}const _=new ht,Ve=(t,n)=>{let r=[],x=[];for(let c=0;c<4;c++){let l=t[c].x,s=t[c].y,i=n[c].x,u=n[c].y;r.push([l,s,1,0,0,0,-l*i,-s*i]),r.push([0,0,0,l,s,1,-l*u,-s*u]),x.push(i),x.push(u)}const p=8;for(let c=0;c<p;c++){let l=Math.abs(r[c][c]),s=c;for(let u=c+1;u<p;u++)Math.abs(r[u][c])>l&&(l=Math.abs(r[u][c]),s=u);for(let u=c;u<p;u++){let m=r[s][u];r[s][u]=r[c][u],r[c][u]=m}let i=x[s];x[s]=x[c],x[c]=i;for(let u=c+1;u<p;u++){let m=-r[u][c]/r[c][c];for(let y=c;y<p;y++)c===y?r[u][y]=0:r[u][y]+=m*r[c][y];x[u]+=m*x[c]}}let o=new Array(p).fill(0);for(let c=p-1;c>-1;c--){let l=0;for(let s=c+1;s<p;s++)l+=r[c][s]*o[s];o[c]=(x[c]-l)/r[c][c]}return[[o[0],o[1],o[2]],[o[3],o[4],o[5]],[o[6],o[7],1]]},fe=(t,n,r)=>{const x=t[2][0]*n+t[2][1]*r+t[2][2],p=(t[0][0]*n+t[0][1]*r+t[0][2])/x,o=(t[1][0]*n+t[1][1]*r+t[1][2])/x;return{x:p,y:o}},ft=(t,n,r)=>{const o=Ve([{x:0,y:0},{x:n,y:0},{x:n,y:r},{x:0,y:r}],t);return`matrix3d(${o[0][0]}, ${o[1][0]}, 0, ${o[2][0]},${o[0][1]}, ${o[1][1]}, 0, ${o[2][1]},0, 0, 1, 0,${o[0][2]}, ${o[1][2]}, 0, ${o[2][2]})`},me=(t,n)=>Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2)),de={lerp:(t,n,r)=>t+r*(n-t),smoothstep:t=>t*t*(3-2*t),fade:t=>t*t*t*(t*(t*6-15)+10),grad3:[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],p:new Uint8Array([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151]),init(){if(!this.perm){this.perm=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[t&255]}},dot(t,n,r){return t[0]*n+t[1]*r},noise2D(t,n){this.init();let r=Math.floor(t)&255,x=Math.floor(n)&255;t-=Math.floor(t),n-=Math.floor(n);let p=this.fade(t),o=this.fade(n),c=this.perm[r]+x,l=this.perm[c],s=this.perm[c+1],i=this.perm[r+1]+x,u=this.perm[i],m=this.perm[i+1];return this.lerp(this.lerp(this.dot(this.grad3[l%12],t,n),this.dot(this.grad3[u%12],t-1,n),p),this.lerp(this.dot(this.grad3[s%12],t,n-1),this.dot(this.grad3[m%12],t-1,n-1),p),o)},voronoi(t,n,r="euclidean"){const x=Math.floor(t),p=Math.floor(n);let o=100,c=0;for(let l=-1;l<=1;l++)for(let s=-1;s<=1;s++){const i=x+l,u=p+s,m=(i&255)*31+(u&255)*13;let y=m<<13^m;const M=1-(y*(y*y*15731+789221)+1376312589&2147483647)/1073741824,v=1-((y+1)*((y+1)*(y+1)*15731+789221)+1376312589&2147483647)/1073741824,z=i+.5+.5*Math.sin(M*6.28),k=u+.5+.5*Math.cos(v*6.28);let N;const b=t-z,L=n-k;r==="manhattan"?N=Math.abs(b)+Math.abs(L):r==="chebychev"?N=Math.max(Math.abs(b),Math.abs(L)):N=Math.sqrt(b*b+L*L),N<o&&(o=N,c=M)}return{distance:o,id:c}},fbm(t,n,r,x=2,p=.5,o="standard"){let c=0,l=.5,s=1,i=0;for(let u=0;u<r;u++){let m=this.noise2D(t*s,n*s);o==="turbulence"?m=Math.abs(m):o==="ridge"?(m=1-Math.abs(m),m=m*m):m=(m+1)/2,c+=m*l,i+=l,l*=p,s*=x}return c/i},warp(t,n,r){const x=this.fbm(t,n,2),p=this.fbm(t+5.2,n+1.3,2);return{x:t+r*x,y:n+r*p}}},be={hexToRgb:t=>{let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:{r:0,g:0,b:0}},rgbToHex:(t,n,r)=>"#"+((1<<24)+(t<<16)+(n<<8)+r).toString(16).slice(1),rgbToHsv:(t,n,r)=>{t/=255,n/=255,r/=255;let x=Math.max(t,n,r),p=Math.min(t,n,r),o,c,l=x,s=x-p;if(c=x===0?0:s/x,x===p)o=0;else{switch(x){case t:o=(n-r)/s+(n<r?6:0);break;case n:o=(r-t)/s+2;break;case r:o=(t-n)/s+4;break}o/=6}return{h:o*360,s:c*100,v:l*100}},hsvToRgb:(t,n,r)=>{let x,p,o,c,l,s,i,u;if(t=Math.max(0,Math.min(360,t)),n=Math.max(0,Math.min(100,n)),r=Math.max(0,Math.min(100,r)),n/=100,r/=100,n==0)return x=p=o=r,{r:Math.round(x*255),g:Math.round(p*255),b:Math.round(o*255)};switch(t/=60,c=Math.floor(t),l=t-c,s=r*(1-n),i=r*(1-n*l),u=r*(1-n*(1-l)),c){case 0:x=r,p=u,o=s;break;case 1:x=i,p=r,o=s;break;case 2:x=s,p=r,o=u;break;case 3:x=s,p=i,o=r;break;case 4:x=u,p=s,o=r;break;default:x=r,p=s,o=i}return{r:Math.round(x*255),g:Math.round(p*255),b:Math.round(o*255)}}},{Settings:mt,Eye:bt,EyeOff:gt,Plus:ye,Trash2:le,Move:jt,Grid3X3:yt,Folder:we,ChevronRight:vt,ChevronDown:xe,ChevronUp:Me,Palette:ve,Image:Se,Upload:Re,Play:We,Film:Nt,Activity:Ie,Layers:wt,Workflow:Be,Link:Xe,X:ze,Maximize:zt,AlertTriangle:kt,HardDrive:He,Database:Ye,Video:ue,Blend:$e,File:Ct,FolderPlus:Mt}=pt,ge=({type:t,title:n,top:r,active:x,onClick:p})=>{let o="";return t==="output"?o="-right-3.5 bg-gray-600 border-gray-300 hover:bg-blue-500 hover:border-white":t==="base"?o="-left-3.5 bg-red-900 border-red-500 hover:bg-red-600":t==="blend"?o="-left-3.5 bg-green-900 border-green-500 hover:bg-green-600":o="-left-3.5 bg-lime-900 border-lime-500 hover:bg-lime-600",e.jsx("div",{className:`absolute w-7 h-7 rounded-full border-2 cursor-pointer z-50 transition-all duration-200 flex items-center justify-center ${o} ${x?"bg-white border-blue-400 scale-125 shadow-[0_0_10px_rgba(59,130,246,0.8)]":""}`,style:{top:`${r}px`},title:n,"data-handle":t,onClick:p,children:x&&e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"})})},Ge=({x:t,y:n,index:r,color:x,isSelected:p,onDrag:o,isMoveMode:c})=>{const[l,s]=j.useState(!1);return j.useEffect(()=>{if(l){const i=m=>o(r,m.clientX,m.clientY),u=()=>s(!1);return window.addEventListener("mousemove",i),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",u)}}},[l]),e.jsxs("g",{transform:`translate(${t}, ${n})`,style:{cursor:c||p?"move":"default"},onMouseDown:i=>{p&&(i.stopPropagation(),s(!0))},onClick:i=>i.stopPropagation(),children:[e.jsx("circle",{r:"30",fill:"transparent"}),e.jsx("circle",{r:"12",fill:c?"#fb923c":x,fillOpacity:p?.3:.1}),e.jsx("circle",{r:p?6:4,fill:c?"#fb923c":x,stroke:"black",strokeWidth:"1"}),p&&e.jsxs("text",{x:"15",y:"5",fill:"white",fontSize:"10",className:"no-select font-mono pointer-events-none",children:["P",r+1]})]})},It=({wallPoints:t})=>{const n=j.useMemo(()=>{const x=Ve([{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],t),p=[],o=10;for(let c=0;c<o;c++)for(let l=0;l<o;l++){const s=l/o,i=c/o,u=(l+1)/o,m=(c+1)/o,y=fe(x,s,i),M=fe(x,u,i),v=fe(x,u,m),z=fe(x,s,m),k=(l+c)%2===0;p.push(e.jsx("path",{d:`M ${y.x} ${y.y} L ${M.x} ${M.y} L ${v.x} ${v.y} L ${z.x} ${z.y} Z`,fill:k?"white":"black",stroke:"none"},`${l}-${c}`))}return p},[t]);return e.jsx("g",{opacity:"0.6",children:n})},$t=({isOpen:t,onClose:n,onImport:r})=>{const[x,p]=j.useState(""),[o,c]=j.useState([]),[l,s]=j.useState(null),[i,u]=j.useState(!1);j.useEffect(()=>{t&&m("")},[t]);const m=async M=>{u(!0);try{const v=await _.listServerFiles(M);p(v.path),c(v.items||[]),s(null)}catch(v){console.error(v)}u(!1)},y=()=>{l&&(r(l),n())};return t?e.jsx("div",{className:"fixed inset-0 z-[210] bg-black/80 backdrop-blur-sm flex items-center justify-center p-8",children:e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-2xl h-[70vh] flex flex-col shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-700 flex justify-between items-center bg-zinc-950",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(He,{size:20,className:"text-blue-400"})," File Explorer"]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white",children:e.jsx(ze,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:i?e.jsx("div",{className:"text-center p-4 text-gray-500 text-xs",children:"Loading..."}):e.jsxs("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-2",children:[o.map((M,v)=>e.jsxs("div",{onClick:()=>M.type==="file"?s(M.path):m(M.path),className:`flex flex-col items-center p-2 rounded cursor-pointer transition-colors ${l===M.path?"bg-blue-900/30 border border-blue-500/50":"hover:bg-zinc-800 border border-transparent"}`,children:[e.jsxs("div",{className:"w-full aspect-square bg-black mb-2 flex items-center justify-center overflow-hidden rounded border border-zinc-800",children:[M.type==="file"?e.jsx("img",{src:`/api/asset/${encodeURIComponent(M.name)}`,className:"w-full h-full object-cover",onError:z=>{z.target.style.display="none",z.target.nextSibling.style.display="block"}}):null,e.jsx("div",{style:{display:M.type==="file"?"none":"block"},children:M.type==="dir"||M.type==="drive"?e.jsx(we,{size:32,className:M.type==="drive"?"text-orange-400":"text-yellow-400"}):e.jsx(Ct,{size:32,className:"text-gray-500"})})]}),e.jsx("span",{className:"text-xs text-gray-300 truncate w-full text-center",children:M.name})]},v)),o.length===0&&e.jsx("div",{className:"text-center p-8 text-gray-600 text-xs",children:"No files found"})]})}),e.jsxs("div",{className:"p-4 border-t border-zinc-800 bg-zinc-900 flex justify-end gap-2",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 rounded text-xs font-bold text-gray-400 hover:text-white hover:bg-zinc-800",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:!l,className:"px-6 py-2 rounded bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:"Import Selected"})]})]})}):null},St=({isOpen:t,onClose:n,onSelect:r,showConfirm:x,showAlert:p,initialTab:o="image"})=>{const[c,l]=j.useState(o),[s,i]=j.useState([]),[u,m]=j.useState(!1);j.useEffect(()=>{t&&(l(o),y())},[t,o]);const y=async()=>{const k=await _.getAllAssets();i(k)},M=async k=>{console.log("[IMPORT] Starting import for:",k);try{const N=await _.importAssetFromPath(k);if(console.log("[IMPORT] Server response received:",N),m(!1),console.log("[IMPORT] Reloading asset list..."),await y(),console.log("[IMPORT] Asset list reloaded."),N&&N.mime_type){const b=N.mime_type.startsWith("video")?"video":"image";console.log("[IMPORT] Detected type:",b),b!==c?p("Import Successful",`Asset imported, but it is not available in current ${c} view.`):p("Import Successful","The asset has been added to your library.")}}catch(N){console.error("[IMPORT] Error during import:",N),p("Import Failed","There was an error importing the file.")}},v=async(k,N)=>{k.stopPropagation(),x("Delete Asset","Are you sure you want to delete this asset from the library?",async()=>{await _.deleteAsset(N),await y()})},z=s.filter(k=>k.type===c);return t?e.jsxs("div",{className:"fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm flex items-center justify-center p-8",children:[e.jsx($t,{isOpen:u,onClose:()=>m(!1),onImport:M}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-4xl h-[80vh] flex flex-col shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-700 flex justify-between items-center bg-zinc-950",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(we,{size:20,className:"text-blue-400"})," Asset Library"]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white",children:e.jsx(ze,{size:24})})]}),e.jsxs("div",{className:"flex border-b border-zinc-800 bg-zinc-900",children:[o==="image"&&e.jsxs("button",{onClick:()=>l("image"),className:`flex-1 py-3 text-sm font-bold flex items-center justify-center gap-2 ${c==="image"?"text-blue-400 border-b-2 border-blue-400 bg-zinc-800/50":"text-gray-500 hover:text-gray-300"}`,children:[e.jsx(Se,{size:16})," Images"]}),o==="video"&&e.jsxs("button",{onClick:()=>l("video"),className:`flex-1 py-3 text-sm font-bold flex items-center justify-center gap-2 ${c==="video"?"text-pink-400 border-b-2 border-pink-400 bg-zinc-800/50":"text-gray-500 hover:text-gray-300"}`,children:[e.jsx(ue,{size:16})," Videos"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-zinc-900/50",children:e.jsxs("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-4",children:[e.jsxs("div",{onClick:()=>m(!0),className:"aspect-square border-2 border-dashed border-zinc-700 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 hover:bg-zinc-800 transition-colors group",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-zinc-800 flex items-center justify-center mb-2 group-hover:bg-blue-600 transition-colors",children:e.jsx(He,{size:24,className:"text-gray-400 group-hover:text-white"})}),e.jsx("span",{className:"text-xs font-bold text-gray-500 group-hover:text-gray-300",children:"Browse Server"})]}),z.map(k=>e.jsxs("div",{onClick:()=>r(k),className:"aspect-square bg-black border border-zinc-700 rounded-lg overflow-hidden relative group cursor-pointer hover:ring-2 hover:ring-blue-500",children:[k.type==="video"?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-zinc-800",children:[e.jsx(ue,{size:48,className:"text-zinc-600 mb-2"}),e.jsx("span",{className:"text-[10px] text-zinc-500 font-bold uppercase",children:"Video Asset"})]}):e.jsx("img",{src:k.url,className:"w-full h-full object-cover",loading:"lazy"}),"                                                                ",e.jsxs("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100",children:["                                    ",e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:N=>v(N,k.id),className:"p-1.5 bg-red-600 rounded-md text-white hover:bg-red-500 shadow-lg",title:"Delete Asset",children:e.jsx(le,{size:14})})}),e.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg transform translate-y-4 group-hover:translate-y-0 transition-transform",children:"Select"})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 backdrop-blur px-2 py-1",children:e.jsx("p",{className:"text-[10px] text-gray-300 truncate",children:k.file.name})})]},k.id))]})})]})]}):null},_e=()=>e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"relative w-64",children:[e.jsx("img",{src:"/robotic T M.png",alt:"Logo",className:"w-full relative z-10"}),e.jsx("div",{className:"absolute inset-0 z-20 bg-gradient-to-r from-transparent via-white/50 to-transparent w-1/2 h-full -skew-x-12 blur-md animate-shimmer",style:{mixBlendMode:"overlay"}})]}),e.jsx("div",{className:"mt-8 text-white font-bold tracking-[0.2em] text-5xl animate-pulse",children:"LOADING SYSTEM"})]}),At=({isOpen:t,onClose:n,activeProjectId:r,showConfirm:x,showAlert:p})=>{const[o,c]=j.useState([]),[l,s]=j.useState(""),[i,u]=j.useState(!1),[m,y]=j.useState(!1);j.useEffect(()=>{t&&M()},[t]);const M=async()=>{u(!0);const N=await _.listProjects();c(N),u(!1)},v=async()=>{if(l.trim()){u(!0);try{await _.createProject(l),window.location.reload()}catch(N){console.error(N),u(!1)}}},z=async N=>{y(!0);try{await _.loadProject(N)}catch(b){console.error(b),y(!1)}},k=n&&o.some(N=>N.id===r);return t?e.jsxs("div",{className:"fixed inset-0 z-[300] bg-black/90 backdrop-blur-md flex items-center justify-center p-8",children:[m&&e.jsx(_e,{}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 rounded-xl w-full max-w-md p-6 shadow-2xl",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(Ye,{size:24,className:"text-blue-500"})," Project Manager"]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 mb-2 block",children:"CREATE NEW PROJECT"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:N=>s(N.target.value),placeholder:"Project Name",className:"flex-1 bg-zinc-950 border border-zinc-700 rounded px-3 py-2 text-white outline-none focus:border-blue-500"}),e.jsx("button",{onClick:v,disabled:i||!l,className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold disabled:opacity-50",children:"Create"})]})]}),e.jsxs("div",{className:"border-t border-zinc-800 pt-4",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 mb-2 block",children:"EXISTING PROJECTS"}),e.jsxs("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:[o.map(N=>e.jsxs("div",{className:`flex items-center justify-between p-3 bg-zinc-800 hover:bg-zinc-700 rounded transition-colors group ${N.id===r?"border border-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.3)]":""}`,children:[e.jsx("div",{onClick:()=>z(N.id),className:"flex-1 cursor-pointer",children:e.jsx("span",{className:"font-bold text-gray-200",children:N.name})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>z(N.id),className:"text-xs text-gray-500 hover:text-white px-2 py-1",children:N.id===r?"Reload":"Load"}),e.jsx("button",{onClick:async b=>{b.stopPropagation(),x("Delete Project",`Are you sure you want to delete project "${N.name}"? This cannot be undone.`,async()=>{await _.deleteProject(N.id),M()})},className:"text-gray-500 hover:text-red-400 p-1",children:e.jsx(le,{size:14})})]})]},N.id)),o.length===0&&e.jsx("div",{className:"text-center text-gray-600 py-4 text-sm",children:"No projects found. Create one to start."})]})]}),k&&e.jsx("button",{onClick:n,className:"mt-6 w-full py-2 text-xs text-gray-500 hover:text-white",children:"Cancel"})]})]}):null},Et=({type:t="perlin",scale:n=5,detail:r=4,time:x=0,distortion:p=0,isAnimating:o=!1,animSpeed:c=.1})=>{const l=j.useRef(null),s=j.useRef(0),i=j.useRef(0);return j.useEffect(()=>{let u;const m=y=>{const M=l.current;if(!M)return;if(o){const W=y-(i.current||y);s.current+=W/1e3*c*10,i.current=y}const v=M.getContext("2d",{alpha:!1}),{width:z,height:k}=M,N=v.createImageData(z,k),b=N.data,L=z/k,R=x+s.current;for(let W=0;W<b.length;W+=4){let ee=W/4%z/z,ne=Math.floor(W/4/z)/k;ee*=L;let B=ee*n,H=ne*n;const q=R*.1;if(p>0){const J=de.warp(B,H+q,p);B=J.x,H=J.y}let U=0;if(t==="perlin")U=de.noise2D(B,H+q),U=(U+1)/2;else if(t==="fbm")U=de.fbm(B,H+q,Math.floor(r));else if(t==="ridge")U=de.fbm(B,H+q,Math.floor(r),2,.5,"ridge");else if(t==="worley"){const J=de.voronoi(B,H+q,"euclidean");U=1-Math.min(1,J.distance)}else t==="cells"&&(U=de.voronoi(B,H+q,"euclidean").id);U=Math.max(0,Math.min(1,U));const re=U*255;b[W]=re,b[W+1]=re,b[W+2]=re,b[W+3]=255}v.putImageData(N,0,0),u=requestAnimationFrame(m)};return u=requestAnimationFrame(m),()=>cancelAnimationFrame(u)},[t,n,r,x,p,o,c]),e.jsx("canvas",{ref:l,width:"256",height:"256",style:{width:"100%",height:"100%",objectFit:"cover"}})},qe=({value:t,onChange:n,className:r})=>{const[x,p]=j.useState(!1),[o,c]=j.useState("grid"),[l,s]=j.useState([]),[i,u]=j.useState({h:0,s:0,v:100});j.useEffect(()=>{const v=localStorage.getItem("emap_custom_colors");v&&s(JSON.parse(v))},[]),j.useEffect(()=>{if(x){const v=be.hexToRgb(t);u(be.rgbToHsv(v.r,v.g,v.b))}},[x,t]);const m=()=>{if(!l.includes(t)){const v=[...l,t].slice(-16);s(v),localStorage.setItem("emap_custom_colors",JSON.stringify(v))}},y=v=>{u(v);const z=be.hsvToRgb(v.h,v.s,v.v);n(be.rgbToHex(z.r,z.g,z.b))},M=[["#ffffff","#e9ecef","#dee2e6","#ced4da","#adb5bd","#6c757d","#495057","#343a40","#212529","#000000"],["#ffe3e3","#ffc9c9","#ffa8a8","#ff8787","#ff6b6b","#fa5252","#f03e3e","#e03131","#c92a2a","#a61e4d"],["#ffdeeb","#fcc2d7","#faa2c1","#f783ac","#f06595","#e64980","#d6336c","#c2255c","#a61e4d","#821135"],["#f3d9fa","#eebefa","#e599f7","#da77f2","#cc5de8","#be4bdb","#ae3ec9","#9c36b5","#862e9c","#702459"],["#e5dbff","#d0bfff","#b197fc","#9775fa","#845ef7","#7950f2","#7048e8","#6741d9","#5f3dc4","#52329e"],["#dbe4ff","#bac8ff","#91a7ff","#748ffc","#5c7cfa","#4c6ef5","#4263eb","#3b5bdb","#364fc7","#2b3a55"],["#d0ebff","#a5d8ff","#74c0fc","#4dabf7","#339af0","#228be6","#1c7ed6","#1971c2","#1864ab","#0b3d91"],["#c5f6fa","#99e9f2","#66d9e8","#3bc9db","#22b8cf","#15aabf","#1098ad","#0c8599","#0b7285","#085f66"],["#c3fae8","#96f2d7","#63e6be","#38d9a9","#20c997","#12b886","#0ca678","#099268","#087f5b","#06664d"],["#d3f9d8","#b2f2bb","#8ce99a","#69db7c","#51cf66","#40c057","#37b24d","#2f9e44","#2b8a3e","#237032"],["#fff3bf","#ffec99","#ffe066","#ffd43b","#fcc419","#fab005","#f59f00","#f08c00","#e67700","#d9480f"],["#fff9db","#fff3bf","#ffec99","#ffe066","#ffd43b","#fcc419","#fab005","#f59f00","#f08c00","#e67700"]];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`relative ${r}`,children:e.jsx("div",{onClick:()=>p(!0),className:"w-full h-full min-w-[20px] min-h-[20px] rounded border border-zinc-600 cursor-pointer shadow-sm flex items-center justify-center overflow-hidden",style:{backgroundColor:t}})}),x&&Ue.createPortal(e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>p(!1),children:e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 rounded-xl shadow-2xl p-4 w-80 flex flex-col gap-4 animate-scale",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-zinc-700 pb-2",children:[e.jsx("h3",{className:"text-sm font-bold text-white",children:"Select Color"}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-500 hover:text-white",children:e.jsx(ze,{size:16})})]}),e.jsxs("div",{className:"flex border-b border-zinc-700 pb-2",children:[e.jsx("button",{onClick:()=>c("grid"),className:`flex-1 text-xs font-bold py-1 ${o==="grid"?"text-white border-b-2 border-blue-500":"text-gray-500 hover:text-gray-300"}`,children:"Grid"}),e.jsx("button",{onClick:()=>c("custom"),className:`flex-1 text-xs font-bold py-1 ${o==="custom"?"text-white border-b-2 border-blue-500":"text-gray-500 hover:text-gray-300"}`,children:"Custom"})]}),o==="grid"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-10 gap-1.5",children:M.flat().map((v,z)=>e.jsx("div",{onClick:()=>{n(v),p(!1)},className:"w-6 h-6 rounded-sm cursor-pointer hover:scale-125 transition-transform border border-transparent hover:border-white shadow-sm",style:{backgroundColor:v},title:v},z))}),l.length>0&&e.jsxs("div",{className:"pt-2 border-t border-zinc-800",children:[e.jsx("div",{className:"text-[10px] text-gray-500 font-bold mb-1",children:"SAVED"}),e.jsx("div",{className:"grid grid-cols-8 gap-1",children:l.map((v,z)=>e.jsx("div",{onClick:()=>{n(v),p(!1)},className:"w-6 h-6 rounded-full cursor-pointer hover:scale-110 transition-transform border border-zinc-700",style:{backgroundColor:v},title:v},z))})]})]}),o==="custom"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full h-40 rounded-lg relative cursor-crosshair shadow-inner border border-zinc-700",style:{backgroundColor:`hsl(${i.h}, 100%, 50%)`,backgroundImage:"linear-gradient(to right, #fff, transparent), linear-gradient(to top, #000, transparent)"},onMouseDown:v=>{const z=v.target.getBoundingClientRect(),k=b=>{const L=Math.max(0,Math.min(1,(b.clientX-z.left)/z.width)),R=Math.max(0,Math.min(1,(b.clientY-z.top)/z.height));y({...i,s:L*100,v:(1-R)*100})};k(v);const N=()=>{window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",N)};window.addEventListener("mousemove",k),window.addEventListener("mouseup",N)},children:e.jsx("div",{className:"absolute w-4 h-4 border-2 border-white rounded-full shadow-md pointer-events-none transform -translate-x-1/2 -translate-y-1/2",style:{left:`${i.s}%`,top:`${100-i.v}%`}})}),e.jsxs("div",{className:"relative h-4 rounded-full overflow-hidden border border-zinc-700",children:[e.jsx("div",{className:"absolute inset-0",style:{background:"linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)"}}),e.jsx("input",{type:"range",min:"0",max:"360",value:i.h,onChange:v=>y({...i,h:parseFloat(v.target.value)}),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-white border border-gray-400 pointer-events-none",style:{left:`${i.h/360*100}%`}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 bg-zinc-800 rounded px-2 py-1 flex items-center border border-zinc-700",children:[e.jsx("span",{className:"text-gray-500 text-xs mr-1",children:"#"}),e.jsx("input",{type:"text",value:t.replace("#",""),onChange:v=>{const z="#"+v.target.value;/^#[0-9A-F]{6}$/i.test(z)&&n(z)},className:"bg-transparent border-none outline-none text-xs text-white w-full font-mono uppercase"})]}),e.jsx("button",{onClick:m,className:"bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 text-gray-300 rounded px-3 py-1 text-xs font-bold",title:"Save to presets",children:e.jsx(ye,{size:14})})]})]})]})}),document.body)]})},je=({value:t,onChange:n,options:r,className:x="",buttonClassName:p="bg-zinc-950 border-zinc-700 p-2"})=>{const[o,c]=j.useState(!1),l=j.useRef(null);j.useEffect(()=>{const i=u=>{l.current&&!l.current.contains(u.target)&&c(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const s=r.find(i=>i.value===t)||r[0];return e.jsxs("div",{className:`relative ${x}`,ref:l,children:[e.jsxs("div",{className:`w-full text-sm rounded text-white font-medium cursor-pointer flex justify-between items-center border hover:border-zinc-500 transition-colors ${p}`,onClick:()=>c(!o),children:[e.jsx("span",{className:"truncate",children:(s==null?void 0:s.label)||t}),e.jsx(xe,{size:14,className:`transition-transform ${o?"rotate-180":""} ml-2 flex-shrink-0`})]}),o&&e.jsx("div",{className:"absolute z-[100] w-full mt-1 bg-zinc-900 border border-zinc-700 rounded shadow-xl max-h-60 overflow-y-auto left-0 min-w-[100px]",children:r.map(i=>e.jsx("div",{className:`px-3 py-2 text-xs cursor-pointer hover:bg-blue-600 hover:text-white transition-colors ${i.value===t?"bg-zinc-800 text-blue-400":"text-gray-300"}`,onClick:u=>{u.stopPropagation(),n(i.value),c(!1)},children:i.label},i.value))})]})},Ne=({nodeId:t,nodes:n,connections:r,resolution:x,wallColor:p,isLive:o,isTransitioning:c})=>{const l=n.find(i=>i.id===t);if(!l)return null;const s=()=>{const i=l.data.fit||"cover",u=l.data.scale||1,m=l.data.rotate||0,y=l.data.alignX??50,M=l.data.alignY??50,v=i==="fill",z=v?50:y,k=v?50:M;return{width:"100%",height:"100%",objectFit:i,objectPosition:v?"center":`${y}% ${M}%`,transform:`scale(${u}) rotate(${m}deg)`,transformOrigin:`${z}% ${k}%`}};if(l.type==="color")return e.jsx("div",{style:{width:"100%",height:"100%",position:"relative",backgroundColor:l.data.value||"black"}});if(l.type==="image"||l.type==="video"){const i=s();return e.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",backgroundColor:o?"black":"transparent"},children:[l.type==="image"&&l.data.value&&e.jsx("img",{src:l.data.value,style:i}),l.type==="video"&&l.data.value&&e.jsx("video",{src:l.data.value,style:i,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,crossOrigin:"anonymous"},l.data.value)]})}if(l.type==="noise")return e.jsx(Et,{type:l.data.noiseType,scale:l.data.scale,detail:l.data.detail,time:l.data.time,distortion:l.data.distortion,isAnimating:l.data.isAnimating,animSpeed:l.data.animSpeed});if(l.type==="mix"){const i=r.find(m=>m.to===t&&m.toHandle==="base"),u=r.find(m=>m.to===t&&m.toHandle==="blend");return e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[e.jsx("div",{style:{position:"absolute",inset:0},children:i&&e.jsx(Ne,{nodeId:i.from,nodes:n,connections:r,resolution:x,wallColor:p,isLive:o,isTransitioning:c})}),u&&e.jsx("div",{style:{position:"absolute",inset:0,mixBlendMode:l.data.blendMode||"normal"},children:e.jsx(Ne,{nodeId:u.from,nodes:n,connections:r,resolution:x,wallColor:p,isLive:o,isTransitioning:c})})]})}return null},Ze=(t,n,r)=>{const x={...n.data};return["scale","alignX","alignY","rotate","opacity","distortion","detail","time","animSpeed"].forEach(o=>{let c=0;o==="scale"&&(c=1),(o==="alignX"||o==="alignY")&&(c=50),o==="detail"&&(c=4),o==="animSpeed"&&(c=.1);const l=t.data[o]??c,s=n.data[o]??c;typeof l=="number"&&typeof s=="number"&&(x[o]=l+(s-l)*r)}),{...n,data:x}},Pt=({prevCueState:t,currentCueState:n,mix:r,walls:x,isLive:p})=>{const o=(l,s)=>{var m;if(!l||!l.nodes)return null;const i=l.nodes.find(y=>y.type==="output"&&y.data.wallId===s);if(!i)return null;const u=(m=l.connections)==null?void 0:m.find(y=>y.to===i.id);return u?u.from:null},c=r<1&&!!t;return e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:x.map(l=>{const s=o(t,l.id),i=o(n,l.id),u=l.points,m=Math.max(me(u[0],u[1]),me(u[2],u[3])),y=Math.max(me(u[1],u[2]),me(u[3],u[0])),M=ft(l.points,m,y),v=s&&i&&s===i;let z=null;if(i){let N=n.nodes;c&&v&&(N=n.nodes.map(b=>{var R;const L=(R=t.nodes)==null?void 0:R.find(W=>W.id===b.id);return L?Ze(L,b,r):b})),z=e.jsx(Ne,{nodeId:i,nodes:N,connections:n.connections,resolution:y,wallColor:l.color,isLive:p,isTransitioning:c})}const k=c&&!v?r:1;return e.jsxs("div",{className:"absolute left-0 top-0 origin-top-left will-change-transform",style:{width:`${m}px`,height:`${y}px`,transform:M,overflow:"hidden"},children:[c&&!v&&s&&e.jsx("div",{style:{opacity:1-r,position:"absolute",inset:0,width:"100%",height:"100%"},children:e.jsx(Ne,{nodeId:s,nodes:t.nodes,connections:t.connections,resolution:y,wallColor:l.color,isLive:p,isTransitioning:c})},s),z&&e.jsx("div",{style:{opacity:k,position:"absolute",inset:0,width:"100%",height:"100%"},children:z},i)]},l.id)})})},Ot=({walls:t,currentCueState:n,isLive:r,isTransitioning:x,shouldShow:p})=>r||x||!p?null:e.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none z-0",style:{backgroundColor:"transparent"},children:[e.jsx("defs",{children:e.jsx("pattern",{id:"zebra-pattern",width:"20",height:"20",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)",children:e.jsx("rect",{width:"10",height:"20",fill:"currentColor"})})}),t.map(o=>{var l;return((l=n==null?void 0:n.nodes)==null?void 0:l.some(s=>{var i;return s.type==="output"&&s.data.wallId===o.id&&((i=n.connections)==null?void 0:i.some(u=>u.to===s.id))}))?e.jsx("g",{children:e.jsx("path",{d:`M ${o.points[0].x} ${o.points[0].y} L ${o.points[1].x} ${o.points[1].y} L ${o.points[2].x} ${o.points[2].y} L ${o.points[3].x} ${o.points[3].y} Z`,fill:"url(#zebra-pattern)",className:"zebra-pattern-path",color:o.color,stroke:"none"})},o.id):null})]}),Tt=({id:t,type:n,x:r,y:x,label:p,selected:o,onDragStart:c,onHandleClick:l,data:s,updateData:i,isConnecting:u,activeConnectionId:m,onDelete:y,onOpenAssetBrowser:M})=>{const v=n==="mix",z=n==="image"||n==="video",k=n==="output",N=n==="noise";return e.jsxs("div",{className:`absolute w-64 pb-2 rounded-lg border shadow-xl flex flex-col visible bg-zinc-800/95 backdrop-blur-sm ${o?"border-blue-500 ring-1 ring-blue-500":"border-zinc-600"}`,style:{transform:`translate(${r}px, ${x}px)`},children:[e.jsxs("div",{className:`px-3 py-2 rounded-t-lg text-xs font-bold uppercase flex justify-between items-center cursor-grab active:cursor-grabbing ${n==="output"?"bg-lime-900 text-lime-200":z?"bg-purple-900 text-purple-200":v?"bg-orange-900 text-orange-200":"bg-zinc-700 text-gray-300"}`,onMouseDown:b=>{b.stopPropagation(),c(b,t)},children:[e.jsxs("span",{className:"flex items-center gap-2",children:[n==="image"&&e.jsx(Se,{size:14}),n==="video"&&e.jsx(ue,{size:14}),n==="color"&&e.jsx(ve,{size:14}),n==="noise"&&e.jsx(Ie,{size:14}),n==="mix"&&e.jsx($e,{size:14}),n]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(s==null?void 0:s.name)&&e.jsx("span",{className:"truncate max-w-[100px] opacity-70",title:s.name,children:s.name}),n!=="output"&&e.jsx("button",{onClick:()=>y(t),className:"text-gray-500 hover:text-red-400 transition-colors",title:"Delete Node",children:e.jsx(ze,{size:14})})]})]}),e.jsxs("div",{className:"p-3 space-y-3 cursor-default",onMouseDown:b=>b.stopPropagation(),children:[e.jsx("div",{className:"text-sm font-bold text-gray-200",children:p}),n==="color"&&e.jsx("div",{className:"w-full h-10",children:e.jsx(qe,{value:(s==null?void 0:s.value)||"#ffffff",onChange:b=>i(t,{value:b}),className:"w-full h-full"})}),n==="mix"&&e.jsx("div",{children:e.jsx(je,{value:(s==null?void 0:s.blendMode)||"normal",onChange:b=>i(t,{blendMode:b}),buttonClassName:"bg-zinc-950 border-zinc-600 p-3",options:[{value:"normal",label:"Normal"},{value:"multiply",label:"Multiply"},{value:"screen",label:"Screen"},{value:"overlay",label:"Overlay"},{value:"darken",label:"Darken"},{value:"lighten",label:"Lighten"},{value:"difference",label:"Difference"},{value:"add",label:"Add"}]})}),(n==="image"||n==="video")&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"w-full h-24 bg-black border border-zinc-700 rounded overflow-hidden flex items-center justify-center relative group",children:[s!=null&&s.value?n==="video"?e.jsx("video",{src:s.value,className:"w-full h-full object-contain",muted:!0}):e.jsx("img",{src:s.value,className:"w-full h-full object-contain"}):e.jsx("div",{className:"text-gray-600 flex flex-col items-center",children:e.jsx(Re,{size:24})}),e.jsxs("button",{onClick:()=>M(n,b=>i(t,{value:b.url,assetId:b.id,name:b.file.name})),className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center text-sm transition-opacity font-bold",children:[e.jsx(Re,{size:16,className:"mr-2"})," Load Media"]})]})}),(n==="image"||n==="video")&&e.jsxs("div",{className:"space-y-2 border-t border-zinc-700 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 font-bold block mb-1",children:"Mode"}),e.jsx(je,{value:(s==null?void 0:s.fit)||"cover",onChange:b=>i(t,{fit:b}),buttonClassName:"bg-zinc-900 border-zinc-700 p-1 text-xs",options:[{value:"cover",label:"Cover (Zoom)"},{value:"contain",label:"Contain (Fit)"},{value:"fill",label:"Stretch"}]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 font-bold block mb-1",children:["Scale: ",(s==null?void 0:s.scale)||1]}),e.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.01",value:(s==null?void 0:s.scale)??1,onChange:b=>i(t,{scale:parseFloat(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 font-bold block mb-1",children:["Rotation: ",(s==null?void 0:s.rotate)||0,"Â°"]}),e.jsx("input",{type:"range",min:"-180",max:"180",step:"1",value:(s==null?void 0:s.rotate)??0,onChange:b=>i(t,{rotate:parseInt(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer"})]}),(s==null?void 0:s.fit)!=="fill"&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 font-bold block mb-1",children:["Position (",(s==null?void 0:s.alignX)??50,"%, ",(s==null?void 0:s.alignY)??50,"%)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:(s==null?void 0:s.alignX)??50,onChange:b=>i(t,{alignX:parseInt(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer",title:"Horizontal Position"}),e.jsx("input",{type:"range",min:"0",max:"100",value:(s==null?void 0:s.alignY)??50,onChange:b=>i(t,{alignY:parseInt(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer",title:"Vertical Position"})]})]})]}),N&&e.jsxs("div",{className:"border-t border-zinc-700 pt-3 mt-2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs text-gray-400 font-bold",children:"Noise Type"}),e.jsx(je,{value:(s==null?void 0:s.noiseType)||"perlin",onChange:b=>i(t,{noiseType:b}),className:"w-32",buttonClassName:"bg-zinc-900 border-zinc-700 p-1 px-2 text-xs",options:[{value:"perlin",label:"Perlin (Soft)"},{value:"fbm",label:"Clouds (FBM)"},{value:"ridge",label:"Electricity (Ridge)"},{value:"worley",label:"Bubbles (Voronoi)"},{value:"cells",label:"Cells (Voronoi ID)"}]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 block mb-1",children:["Scale: ",(s==null?void 0:s.scale)||5]}),e.jsx("input",{type:"range",min:"1",max:"100",step:"0.5",value:(s==null?void 0:s.scale)??5,onChange:b=>i(t,{scale:parseFloat(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 block mb-1",children:[(s==null?void 0:s.noiseType)==="fbm"?"Octaves":"Detail",": ",(s==null?void 0:s.detail)||4]}),e.jsx("input",{type:"range",min:"1",max:(s==null?void 0:s.noiseType)==="fbm"?8:10,step:(s==null?void 0:s.noiseType)==="fbm"?1:.5,value:(s==null?void 0:s.detail)??4,onChange:b=>i(t,{detail:parseFloat(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 block mb-1",children:["Distortion: ",(s==null?void 0:s.distortion)||0]}),e.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:(s==null?void 0:s.distortion)??0,onChange:b=>i(t,{distortion:parseFloat(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer"})]}),e.jsxs("div",{className:"pt-2 border-t border-zinc-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs text-gray-400 font-bold",children:"Animate"}),e.jsx("input",{type:"checkbox",checked:(s==null?void 0:s.isAnimating)??!1,onChange:b=>i(t,{isAnimating:b.target.checked}),className:"form-checkbox h-4 w-4 text-blue-600 bg-zinc-800 border-zinc-600 rounded focus:ring-blue-500"})]}),s!=null&&s.isAnimating?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 block mb-1 mt-2",children:["Animation Speed: ",(s==null?void 0:s.animSpeed)||.1]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(s==null?void 0:s.animSpeed)??.1,onChange:b=>i(t,{animSpeed:parseFloat(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer"})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"text-[10px] text-gray-500 block mb-1 mt-2",children:"Time"}),e.jsx("input",{type:"range",min:"0",max:"100",step:"0.1",value:(s==null?void 0:s.time)??0,onChange:b=>i(t,{time:parseFloat(b.target.value)}),className:"w-full h-2 bg-zinc-600 rounded appearance-none cursor-pointer"})]})]})]})]}),!k&&e.jsx(ge,{type:"output",title:"Output",top:50,active:u&&m===t,onClick:b=>{b.stopPropagation(),l(t,"output")}}),k&&e.jsx(ge,{type:"input",title:"Input",top:50,onClick:b=>{b.stopPropagation(),l(t,"input")}}),v&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{type:"base",title:"Base Layer",top:50,onClick:b=>{b.stopPropagation(),l(t,"base")}}),e.jsx(ge,{type:"blend",title:"Blend Layer",top:90,onClick:b=>{b.stopPropagation(),l(t,"blend")}}),e.jsx("span",{className:"absolute -left-12 top-[54px] text-[10px] text-gray-400 pointer-events-none w-8 text-right font-bold",children:"Base"}),e.jsx("span",{className:"absolute -left-12 top-[94px] text-[10px] text-gray-400 pointer-events-none w-8 text-right font-bold",children:"Blend"})]})]})},Dt=({activeSelection:t,currentCue:n,updateCueData:r,walls:x,setWalls:p,onOpenAssetBrowser:o})=>{const[c,l]=j.useState([]),[s,i]=j.useState([]),[u,m]=j.useState({x:0,y:0}),[y,M]=j.useState(1),[v,z]=j.useState(null),k=j.useRef({x:0,y:0}),[N,b]=j.useState(null),[L,R]=j.useState(null),[W,ee]=j.useState(null);j.useEffect(()=>{if(n)if(t.type==="transition")l([{id:"n1",type:"state",x:50,y:100,label:"Prev Cue"},{id:"n2",type:"effect",x:300,y:100,label:"Crossfade"},{id:"n3",type:"state",x:600,y:100,label:"Next Cue"}]),i([{from:"n1",to:"n2"},{from:"n2",to:"n3"}]);else if(n.nodes&&n.nodes.length>0){l(n.nodes),i(n.connections);const g=new Set(n.nodes.filter(I=>I.type==="output").map(I=>I.data.wallId)),C=x.filter(I=>!g.has(I.id));if(C.length>0){const I=C.map(($,D)=>({id:`wall-${$.id}`,type:"output",x:800,y:50+(n.nodes.length+D)*150,label:$.name,data:{wallId:$.id}}));l($=>[...$,...I])}}else{const g=x.map((C,I)=>({id:`wall-${C.id}`,type:"output",x:800,y:50+I*200,label:C.name,data:{wallId:C.id}}));l(g),i([])}},[t.cueId,t.type,x.length]),j.useEffect(()=>{t.type==="cue"&&c.length>0&&r({nodes:c,connections:s})},[c,s]);const ne=(g,C)=>{g.stopPropagation();const I=c.find($=>$.id===C);k.current={x:g.clientX-I.x*y-u.x,y:g.clientY-I.y*y-u.y},z(C),b(null)},B=(g,C)=>{if(C==="output")(N==null?void 0:N.id)===g&&(N==null?void 0:N.handle)==="output"?b(null):b({id:g,handle:"output"});else if(N&&N.handle==="output"&&N.id!==g){const I=s.filter($=>!($.to===g&&$.toHandle===C));i([...I,{from:N.id,to:g,toHandle:C}]),b(null)}},H=g=>{if(v){const C=(g.clientX-u.x-k.current.x)/y,I=(g.clientY-u.y-k.current.y)/y;l($=>$.map(D=>D.id===v?{...D,x:C,y:I}:D))}else(g.buttons===4||g.buttons===1&&g.shiftKey)&&m(C=>({x:C.x+g.movementX,y:C.y+g.movementY}))},q=()=>z(null),U=()=>{b(null),R(null)},re=g=>{g.ctrlKey?M(C=>Math.min(Math.max(C-g.deltaY*.001,.5),2)):m(C=>({x:C.x-g.deltaX,y:C.y-g.deltaY}))},J=g=>{g.preventDefault(),R({x:g.clientX,y:g.clientY})},Y=(g,C)=>{const I=`n-${Date.now()}`,$=(window.innerWidth/2-u.x)/y-300,D=(200-u.y)/y;l(T=>[...T,{id:I,type:g,x:$,y:D,label:C,data:g==="color"?{value:"#ffffff"}:g==="noise"?{noiseType:"fbm",scale:5,detail:4,time:0,distortion:0,isAnimating:!1,animSpeed:.05}:{}}]),R(null)},pe=()=>{Y("image","Image Source")},O=(g,C)=>{l(I=>I.map($=>$.id===g?{...$,data:{...$.data,...C}}:$))},he=g=>{i(C=>C.filter((I,$)=>$!==g))},G=g=>{const C=c.find(I=>I.id===g);if(C){if(C.type==="output"){alert("Cannot delete an output node. To remove a wall, delete it from the Geometry panel.");return}l(I=>I.filter($=>$.id!==g)),i(I=>I.filter($=>$.from!==g&&$.to!==g))}},Z=(g,C)=>{if(!g)return{x:0,y:0};const I=256;return C==="output"?{x:g.x+I+8,y:g.y+64}:g.type==="output"?{x:g.x-8,y:g.y+64}:C==="base"?{x:g.x-8,y:g.y+64}:C==="blend"?{x:g.x-8,y:g.y+104}:{x:g.x-8,y:g.y+64}},A=(g,C,I,$)=>{const T=.125*g.x+.375*C.x+.375*I.x+.125*$.x,te=(1-.5)*(1-.5)*(1-.5)*g.y+3*(1-.5)*(1-.5)*.5*C.y+3*(1-.5)*.5*.5*I.y+.5*.5*.5*$.y;return{x:T,y:te}};return e.jsxs("div",{className:"h-full bg-transparent relative overflow-hidden select-none",onMouseMove:H,onMouseUp:q,onMouseLeave:q,onWheel:re,onContextMenu:J,onClick:U,children:[e.jsx("div",{className:"absolute inset-0 node-grid opacity-30",style:{transform:`translate(${u.x}px, ${u.y}px) scale(${y})`,transformOrigin:"0 0"}}),e.jsx("div",{className:"absolute top-2 left-2 z-10 flex gap-2 pointer-events-none",children:e.jsxs("div",{className:"bg-zinc-800/80 backdrop-blur border border-zinc-700 rounded p-2 flex items-center gap-2 shadow-lg pointer-events-auto",children:[e.jsx(Be,{size:14,className:"text-purple-400"}),e.jsx("span",{className:"text-xs font-bold text-gray-300",children:t.type==="transition"?"Transition Logic":"Content Graph"}),t.type==="cue"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-px h-4 bg-zinc-600 mx-1"}),e.jsxs("button",{onClick:pe,className:"flex items-center gap-1 bg-purple-700 hover:bg-purple-600 text-white text-[10px] px-2 py-1 rounded transition-colors",children:[" ",e.jsx(ye,{size:10})," Add Image "]}),e.jsxs("button",{onClick:()=>Y("video","Video"),className:"flex items-center gap-1 bg-pink-700 hover:bg-pink-600 text-white text-[10px] px-2 py-1 rounded transition-colors",children:[" ",e.jsx(ue,{size:10})," Add Video "]}),e.jsxs("button",{onClick:()=>Y("color","Color"),className:"flex items-center gap-1 bg-sky-700 hover:bg-sky-600 text-white text-[10px] px-2 py-1 rounded transition-colors",children:[" ",e.jsx(ve,{size:10})," Add Color "]}),e.jsxs("button",{onClick:()=>Y("mix","Mixer"),className:"flex items-center gap-1 bg-orange-700 hover:bg-orange-600 text-white text-[10px] px-2 py-1 rounded transition-colors",children:[" ",e.jsx($e,{size:10})," Add Mix "]}),e.jsxs("button",{onClick:()=>Y("noise","Noise"),className:"flex items-center gap-1 bg-teal-700 hover:bg-teal-600 text-white text-[10px] px-2 py-1 rounded transition-colors",children:[" ",e.jsx(Ie,{size:10})," Add Noise "]})]})]})}),L&&t.type==="cue"&&e.jsxs("div",{className:"absolute z-50 bg-zinc-800 border border-zinc-600 rounded shadow-xl py-1 w-32",style:{top:L.y-40,left:L.x},children:[e.jsx("div",{className:"px-2 py-1 text-[10px] text-gray-500 font-bold uppercase",children:"Add Node"}),e.jsxs("button",{onClick:()=>Y("image","Image Source"),className:"w-full text-left px-3 py-1.5 text-xs text-white hover:bg-purple-600 flex gap-2",children:[e.jsx(Se,{size:12})," Image"]}),e.jsxs("button",{onClick:()=>Y("video","Video Source"),className:"w-full text-left px-3 py-1.5 text-xs text-white hover:bg-purple-600 flex gap-2",children:[e.jsx(ue,{size:12})," Video"]}),e.jsxs("button",{onClick:()=>Y("color","Color Source"),className:"w-full text-left px-3 py-1.5 text-xs text-white hover:bg-purple-600 flex gap-2",children:[e.jsx(ve,{size:12})," Color"]}),e.jsxs("button",{onClick:()=>Y("noise","Noise Generator"),className:"w-full text-left px-3 py-1.5 text-xs text-white hover:bg-purple-600 flex gap-2",children:[e.jsx(Ie,{size:12})," Noise"]}),e.jsx("div",{className:"w-full h-px bg-zinc-700 my-1"}),e.jsxs("button",{onClick:()=>Y("mix","Mix / Mask"),className:"w-full text-left px-3 py-1.5 text-xs text-white hover:bg-orange-600 flex gap-2",children:[e.jsx($e,{size:12})," Mixer"]})]}),e.jsxs("div",{style:{transform:`translate(${u.x}px, ${u.y}px) scale(${y})`,transformOrigin:"0 0",width:"100%",height:"100%"},children:[e.jsx("svg",{className:"absolute inset-0 overflow-visible pointer-events-auto",children:s.map((g,C)=>{const I=c.find(Q=>Q.id===g.from),$=c.find(Q=>Q.id===g.to);if(!I||!$)return null;const D=Z(I,"output"),T=Z($,g.toHandle||"input"),te=D.x+(T.x-D.x)/2,se=T.x-(T.x-D.x)/2,oe=W===C,ie=A({x:D.x,y:D.y},{x:te,y:D.y},{x:se,y:T.y},{x:T.x,y:T.y});return e.jsxs("g",{onMouseEnter:()=>ee(C),onMouseLeave:()=>ee(null),children:[e.jsx("path",{d:`M ${D.x} ${D.y} C ${te} ${D.y}, ${se} ${T.y}, ${T.x} ${T.y}`,fill:"none",stroke:"transparent",strokeWidth:"20"}),e.jsx("path",{d:`M ${D.x} ${D.y} C ${te} ${D.y}, ${se} ${T.y}, ${T.x} ${T.y}`,fill:"none",stroke:oe?"#ef4444":"#555",strokeWidth:"2"}),oe&&e.jsx("foreignObject",{x:ie.x-12,y:ie.y-12,width:"24",height:"24",className:"overflow-visible",children:e.jsx("div",{className:"w-6 h-6 bg-red-600 rounded-full flex items-center justify-center cursor-pointer hover:scale-125 transition-transform shadow-lg",onClick:Q=>{Q.stopPropagation(),he(C)},title:"Remove Connection",children:e.jsx(le,{size:12,className:"text-white"})})})]},C)})}),c.map(g=>e.jsx("div",{children:e.jsx(Tt,{id:g.id,...g,selected:v===g.id,isConnecting:!!N,activeConnectionId:N==null?void 0:N.id,onDragStart:ne,onHandleClick:B,updateData:O,onDelete:G,onOpenAssetBrowser:o})},g.id))]})]})},Ke=(t,n)=>{if(t<0)return 0;if(t>1)return 1;switch(n){case"easeIn":return t*t;case"easeOut":return t*(2-t);case"easeInOut":return t<.5?2*t*t:-1+(4-2*t)*t;default:return t}},Lt=({cue:t,updateCue:n})=>{if(!t)return e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500 text-xs",children:"Select a transition to edit"});const r=t.transitionDuration??1,x=t.transitionDelay??0,p=t.transitionEase||"linear",{points:o,totalTime:c}=j.useMemo(()=>{const k=Math.max(r+x+1,5),N=100,b=[];for(let L=0;L<=N;L++){const R=L/N*k;let W=0;if(R>=x){const B=r>0?Math.min((R-x)/r,1):1;W=Ke(B,p)}const ee=40+R/k*520,ne=160-W*120;b.push(`${ee},${ne}`)}return{points:b,totalTime:k}},[r,x,p]),l=600,s=200,i=40,u=l-i*2;return e.jsxs("div",{className:"w-full h-full bg-transparent p-6 flex gap-8 text-gray-300",children:[e.jsx("div",{className:"w-64 flex flex-col gap-6 pt-2",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Xe,{size:16})," TRANSITION SETTINGS"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("label",{className:"text-xs font-bold",children:"Duration"}),e.jsxs("span",{className:"text-xs font-mono text-blue-400",children:[r.toFixed(1),"s"]})]}),e.jsx("input",{type:"range",min:"0",max:"10",step:"0.1",value:r,onInput:m=>n({transitionDuration:parseFloat(m.target.value)}),className:"w-full h-2 bg-zinc-700 rounded-lg appearance-none cursor-pointer accent-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("label",{className:"text-xs font-bold",children:"Delay"}),e.jsxs("span",{className:"text-xs font-mono text-orange-400",children:[x.toFixed(1),"s"]})]}),e.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:x,onInput:m=>n({transitionDelay:parseFloat(m.target.value)}),className:"w-full h-2 bg-zinc-700 rounded-lg appearance-none cursor-pointer accent-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold block mb-2",children:"Easing Curve"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["linear","easeIn","easeOut","easeInOut"].map(m=>e.jsx("button",{onClick:()=>n({transitionEase:m}),className:`px-3 py-2 rounded text-xs font-medium border transition-all ${p===m?"bg-blue-600 border-blue-500 text-white":"bg-zinc-800 border-zinc-700 hover:bg-zinc-700"}`,children:m.replace(/([A-Z])/g," $1").replace(/^./,y=>y.toUpperCase())},m))})]})]})]})}),e.jsxs("div",{className:"flex-1 bg-zinc-950 rounded-xl border border-zinc-800 relative shadow-inner overflow-hidden",children:[e.jsx("div",{className:"absolute top-3 left-4 text-[10px] font-mono text-zinc-500",children:"OPACITY / TIME"}),e.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${l} ${s}`,preserveAspectRatio:"none",className:"absolute inset-0",children:[e.jsx("line",{x1:i,y1:s-i,x2:l-i,y2:s-i,stroke:"#333",strokeWidth:"1"}),e.jsx("line",{x1:i,y1:i,x2:i,y2:s-i,stroke:"#333",strokeWidth:"1"}),e.jsx("path",{d:`M ${o.join(" L ")}`,fill:"none",stroke:"#60a5fa",strokeWidth:"3",strokeLinecap:"round"}),e.jsx("path",{d:`M ${o[0]} L ${o.join(" L ")} L ${o[o.length-1].split(",")[0]},${s-i} Z`,fill:"url(#gradient)",opacity:"0.2"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#60a5fa"}),e.jsx("stop",{offset:"100%",stopColor:"transparent"})]})}),e.jsx("line",{x1:i+x/c*u,y1:i,x2:i+x/c*u,y2:s-i,stroke:"#fb923c",strokeWidth:"1",strokeDasharray:"4,4"}),e.jsx("line",{x1:i+(x+r)/c*u,y1:i,x2:i+(x+r)/c*u,y2:s-i,stroke:"#fb923c",strokeWidth:"1",strokeDasharray:"4,4"})]})]})]})},Ft=({walls:t,activeWallId:n})=>t.length===0?null:e.jsxs("div",{className:"mt-4 pt-4 border-t border-zinc-700",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-500 mb-3 flex items-center gap-1",children:[e.jsx(wt,{size:12})," STACKING ORDER"]}),e.jsx("div",{className:"relative h-24 bg-zinc-800/50 rounded-lg p-4 flex items-center justify-start overflow-x-auto",children:t.slice().reverse().map((r,x)=>e.jsx("div",{title:`${r.name}`,className:`absolute w-12 h-12 rounded border-2 transition-all duration-300 ease-out flex items-center justify-center text-white font-bold text-xs shadow-md ${r.id===n?"border-blue-400 ring-2 ring-blue-500/50":"border-zinc-600 hover:border-zinc-400"}`,style:{backgroundColor:r.color,left:`${10+x*15}%`,zIndex:t.length-x,transform:`translateY(${r.id===n?"-8px":"0px"}) scale(${r.id===n?"1.1":"1"})`},children:t.length-x},r.id))})]}),Je=({wall:t,activeWallId:n,setActiveWallId:r,moveWall:x,deleteWall:p})=>e.jsxs("div",{onClick:()=>r(t.id),className:`flex justify-between items-center p-2 rounded text-xs cursor-pointer ${t.id===n?"bg-zinc-700 text-white border border-zinc-600":"text-gray-400 hover:bg-zinc-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:t.color}}),e.jsx("span",{className:"truncate",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col -my-1",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),x(t.id,-1)},className:"p-0.5 rounded hover:bg-zinc-600 text-gray-400 hover:text-white",children:e.jsx(Me,{size:16})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),x(t.id,1)},className:"p-0.5 rounded hover:bg-zinc-600 text-gray-400 hover:text-white",children:e.jsx(xe,{size:16})})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),p(t.id,t.name)},className:"p-1 rounded hover:bg-red-900/50 text-gray-500 hover:text-red-400",children:e.jsx(le,{size:14})})]})]}),Rt=({folder:t,walls:n,activeWallId:r,setActiveWallId:x,setWalls:p,setFolders:o,moveWall:c,deleteWall:l})=>{const s=n.filter(i=>i.folderId===t.id);return e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-zinc-800 hover:bg-zinc-700 rounded cursor-pointer text-xs font-bold text-gray-300",onClick:()=>o(i=>i.map(u=>u.id===t.id?{...u,isOpen:!u.isOpen}:u)),children:[t.isOpen?e.jsx(xe,{size:14}):e.jsx(vt,{size:14})," ",e.jsx(we,{size:14,className:"text-blue-400"})," ",t.name," ",e.jsx("span",{className:"ml-auto text-[10px] text-gray-500",children:s.length}),e.jsx("button",{onClick:i=>{i.stopPropagation(),confirm("Delete folder?")&&(o(u=>u.filter(m=>m.id!==t.id)),p(u=>u.map(m=>m.folderId===t.id?{...m,folderId:null}:m)))},className:"text-gray-500 hover:text-red-400 ml-2",children:e.jsx(le,{size:12})})]}),t.isOpen&&e.jsx("div",{className:"ml-2 pl-2 border-l border-zinc-700 mt-1 space-y-1",children:s.map(i=>e.jsx(Je,{wall:i,activeWallId:r,setActiveWallId:x,moveWall:c,deleteWall:l},i.id))})]})},Wt=({isOpen:t,title:n,message:r,onConfirm:x,onCancel:p,type:o="confirm"})=>t?Ue.createPortal(e.jsx("div",{className:"fixed inset-0 z-[20000] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-scale",children:e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 rounded-xl shadow-2xl p-6 w-96 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[e.jsx(kt,{size:24}),e.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-wider",children:n})]}),e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed",children:r}),e.jsxs("div",{className:"flex justify-end gap-3 mt-2",children:[o==="confirm"&&e.jsx("button",{onClick:p,className:"px-4 py-2 rounded text-xs font-bold text-gray-400 hover:text-white hover:bg-zinc-800 transition-colors",children:"CANCEL"}),e.jsx("button",{onClick:x,className:"px-6 py-2 rounded bg-red-600 hover:bg-red-500 text-white text-xs font-bold shadow-lg shadow-red-900/20 transition-all",children:o==="confirm"?"PROCEED":"OK"})]})]})}),document.body):null;function Gt(){const[t,n]=j.useState({isOpen:!1,title:"",message:"",onConfirm:null,type:"confirm"}),r=(d,a,h)=>n({isOpen:!0,title:d,message:a,onConfirm:()=>{h(),n(f=>({...f,isOpen:!1}))},type:"confirm"}),x=(d,a)=>n({isOpen:!0,title:d,message:a,onConfirm:()=>n(h=>({...h,isOpen:!1})),type:"alert"}),[p,o]=j.useState([{id:1,name:"Main Wall",color:"#84cc16",folderId:null,points:[{x:100,y:100},{x:500,y:100},{x:500,y:325},{x:100,y:325}]}]),[c,l]=j.useState([]),[s,i]=j.useState(1),[u,m]=j.useState(!0),[y,M]=j.useState("2d"),[v,z]=j.useState(!1),[k,N]=j.useState(!1),[b,L]=j.useState(!1),[R,W]=j.useState(!0),[ee,ne]=j.useState(null),[B,H]=j.useState({isOpen:!1,type:"image",callback:null}),[q,U]=j.useState(!1),[re,J]=j.useState(!0),[Y,pe]=j.useState(null),[O,he]=j.useState("config"),[G,Z]=j.useState([]),[A,g]=j.useState({type:"cue",sceneId:null,cueId:null}),[C,I]=j.useState(1),[$,D]=j.useState(null),[T,te]=j.useState(null),se=j.useRef(),oe=j.useRef(),ie=j.useRef(),[Q,Ae]=j.useState(null),ke=j.useRef(O);j.useEffect(()=>{ke.current!=="scenes"&&O==="scenes"?(Ae({showGuides:v,moveMode:k}),z(!1),N(!1)):ke.current==="scenes"&&O!=="scenes"&&Q&&(z(Q.showGuides),N(Q.moveMode),Ae(null)),ke.current=O},[O]),j.useEffect(()=>{(async()=>{var a,h;try{const f=await _.getActiveProject();if(f&&f.id){pe(f.id);const w=await _.loadState("project_data_v22");w&&(o(w.walls||[]),l(w.folders||[]),Z(w.scenes||[]),((a=w.scenes)==null?void 0:a.length)>0&&((h=w.scenes[0].cues)==null?void 0:h.length)>0&&g({type:"cue",sceneId:w.scenes[0].id,cueId:w.scenes[0].cues[0].id}));const S=await _.getUsage();ne(S),U(!1)}else pe(null),U(!0)}catch(f){console.error("Failed to load state",f),U(!0)}finally{setTimeout(()=>J(!1),500)}})()},[]),j.useEffect(()=>(ie.current&&clearTimeout(ie.current),ie.current=setTimeout(async()=>{await _.saveState("project_data_v22",{walls:p,folders:c,scenes:G})},1e3),()=>clearTimeout(ie.current)),[p,c,G]),j.useEffect(()=>{const d=()=>L(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",d),()=>document.removeEventListener("fullscreenchange",d)},[]);const Qe=()=>{L(!0),document.documentElement.requestFullscreen().catch(d=>console.log("Fullscreen request failed:",d))},et=(d,a)=>{const h=G.find(f=>f.id===d);return h?h.cues.find(f=>f.id===a):null},ae=A.type==="cue"?A.cueId:A.nextCueId,K=j.useMemo(()=>et(A.sceneId,ae),[A,G]),Ee=j.useRef(K);j.useEffect(()=>{Ee.current=K},[K]);const Ce=j.useMemo(()=>G.findIndex(d=>d.id===A.sceneId),[G,A.sceneId]),tt=j.useMemo(()=>{const d=G[Ce];return d?d.cues.findIndex(a=>a.id===ae):-1},[Ce,G,ae]),Pe=d=>{Z(a=>a.map(h=>h.id!==A.sceneId?h:{...h,cues:h.cues.map(f=>f.id!==ae?f:{...f,...d})}))},Oe=d=>{oe.current||(oe.current=d);const a=Ee.current,h=((a==null?void 0:a.transitionDuration)||0)*1e3,f=((a==null?void 0:a.transitionDelay)||0)*1e3,w=h+f,S=d-oe.current;let F=1;w>0&&(S<f?F=0:F=h>0?Math.min((S-f)/h,1):1);const E=(a==null?void 0:a.transitionEase)||"linear";I(Ke(F,E)),S<w?se.current=requestAnimationFrame(Oe):(I(1),D(null))};j.useEffect(()=>{var d;if(K){let a=T||$;if(A.type==="transition"&&A.prevCueId){const h=(d=G.find(f=>f.id===A.sceneId))==null?void 0:d.cues.find(f=>f.id===A.prevCueId);h&&(a=h)}else $&&C<1&&(a={...T,nodes:T.nodes.map(h=>{var w;const f=(w=$.nodes)==null?void 0:w.find(S=>S.id===h.id);return f?Ze(f,h,C):h})});D(a),te(K),I(0),oe.current=null,cancelAnimationFrame(se.current),se.current=requestAnimationFrame(Oe)}return()=>cancelAnimationFrame(se.current)},[ae,A.sceneId,A.type,A.prevCueId]),j.useEffect(()=>{A.type==="cue"&&te(K)},[G]);const st=d=>{let a=[];G.forEach(w=>{w.cues.forEach(S=>{a.push({sceneId:w.id,cueId:S.id})})});const h=a.findIndex(w=>w.sceneId===A.sceneId&&w.cueId===ae);if(h===-1)return;let f=h+d;f>=0&&f<a.length&&g({type:"cue",...a[f]})};j.useEffect(()=>{const d=h=>{const f=h.key.toLowerCase();h.ctrlKey&&(f==="r"||f==="f"||f==="p"||f==="s")&&h.preventDefault(),(f==="f5"||f==="f11"||f==="f12")&&h.preventDefault(),f==="h"&&(y==="live"?(M("2d"),m(!0)):m(w=>!w)),f==="g"&&y!=="live"&&z(w=>!w),f==="m"&&y==="2d"&&N(w=>!w),(y==="live"||O==="scenes")&&(f==="z"||f==="v"||h.key==="ArrowRight"||h.key==="ArrowLeft")&&st(f==="z"||h.key==="ArrowRight"?1:-1)},a=h=>h.preventDefault();return window.addEventListener("keydown",d),window.addEventListener("contextmenu",a),()=>{window.removeEventListener("keydown",d),window.removeEventListener("contextmenu",a)}},[y,O,A,G]);const Te=(d,a)=>{Z(h=>{const f=[...h];return d+a<0||d+a>=f.length?h:([f[d],f[d+a]]=[f[d+a],f[d]],f)})},nt=d=>{r("Delete Act","Are you sure you want to delete this Act and all its cues?",()=>{Z(a=>{var f;const h=a.filter(w=>w.id!==d);return A.sceneId===d&&(h.length>0&&((f=h[0].cues)==null?void 0:f.length)>0?g({type:"cue",sceneId:h[0].id,cueId:h[0].cues[0].id}):g({type:"cue",sceneId:null,cueId:null})),h})})},rt=(d,a)=>{r("Delete Cue","Are you sure you want to delete this cue?",()=>{Z(h=>h.map(f=>{if(f.id!==d)return f;const w=f.cues.filter(S=>S.id!==a);if(A.sceneId===d&&A.cueId===a)if(w.length>0)g({type:"cue",sceneId:d,cueId:w[0].id});else{const S=G.find(F=>{var E;return F.id!==d&&((E=F.cues)==null?void 0:E.length)>0});g(S?{type:"cue",sceneId:S.id,cueId:S.cues[0].id}:{type:"cue",sceneId:null,cueId:null})}return{...f,cues:w}}))})},ot=()=>{const d=Date.now(),a=`Act ${G.length+1}`,h={id:d,name:a,cues:[{id:d+1,name:"Cue 1",type:"standard"}]};Z(f=>[...f,h]),G.length===0&&g({type:"cue",sceneId:d,cueId:d+1})},it=d=>{Z(a=>a.map(h=>{if(h.id!==d)return h;const f=Date.now(),w=`Cue ${h.cues.length+1}`,S={...h,cues:[...h.cues,{id:f,name:w,type:"standard"}]};return A.cueId===null&&g({type:"cue",sceneId:d,cueId:f}),S}))},De=(d,a,h,f)=>{o(w=>w.map(S=>{if(S.id!==d)return S;const F=[...S.points];if(k){const E=h-F[a].x,V=f-F[a].y;return{...S,points:F.map(ce=>({x:ce.x+E,y:ce.y+V}))}}return F[a]={x:h,y:f},{...S,points:F}}))},lt=()=>l(d=>[...d,{id:Date.now(),name:"Group",isOpen:!0}]),Le=(d,a)=>{r("Delete Wall",`Are you sure you want to delete the wall "${a}"?`,()=>{s===d&&i(null),o(h=>h.filter(f=>f.id!==d)),Z(h=>h.map(f=>({...f,cues:f.cues.map(w=>{if(!w.nodes)return w;const S=w.nodes.filter(V=>!(V.type==="output"&&V.data.wallId===d)),F=new Set(S.map(V=>V.id)),E=(w.connections||[]).filter(V=>F.has(V.from)&&F.has(V.to));return{...w,nodes:S,connections:E}})})))})},Fe=(d,a)=>{o(h=>{const f=h.findIndex(S=>S.id===d);if(f===-1||f+a<0||f+a>=h.length)return h;const w=[...h];return[w[f],w[f+a]]=[w[f+a],w[f]],w})},X=p.find(d=>d.id===s),at=d=>e.jsxs("svg",{className:"w-full h-full",style:{backgroundColor:d||O==="scenes"?"black":"transparent"},children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"smallGrid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:"0.5"})}),e.jsxs("pattern",{id:"grid",width:"100",height:"100",patternUnits:"userSpaceOnUse",children:[e.jsx("rect",{width:"100",height:"100",fill:"url(#smallGrid)"}),e.jsx("path",{d:"M 100 0 L 0 0 0 100",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"1"})]})]}),v&&!d&&O!=="scenes"&&e.jsxs(e.Fragment,{children:[e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)",pointerEvents:"none"}),e.jsx("line",{x1:"50%",y1:"0",x2:"50%",y2:"100%",stroke:"cyan",strokeOpacity:"0.5",strokeDasharray:"5,5",pointerEvents:"none"}),e.jsx("line",{x1:"0",y1:"50%",x2:"100%",y2:"50%",stroke:"cyan",strokeOpacity:"0.5",strokeDasharray:"5,5",pointerEvents:"none"})]}),p.map(a=>{var F;const f=(E=>({fill:a.color,stroke:d?"none":a.color}))(),w=d?1:a.id===s?.5:.1,S=(d||O==="scenes")&&((F=T==null?void 0:T.nodes)==null?void 0:F.some(E=>{var V;return E.type==="output"&&E.data.wallId===a.id&&((V=T.connections)==null?void 0:V.some(ce=>ce.to===E.id))}));return e.jsxs("g",{onClick:E=>{d||(E.stopPropagation(),i(a.id))},children:[S&&e.jsx("path",{d:`M ${a.points[0].x} ${a.points[0].y} L ${a.points[1].x} ${a.points[1].y} L ${a.points[2].x} ${a.points[2].y} L ${a.points[3].x} ${a.points[3].y} Z`,fill:"transparent",stroke:"none"}),!S&&(d||O==="scenes")&&e.jsx("path",{d:`M ${a.points[0].x} ${a.points[0].y} L ${a.points[1].x} ${a.points[1].y} L ${a.points[2].x} ${a.points[2].y} L ${a.points[3].x} ${a.points[3].y} Z`,fill:f.fill,fillOpacity:w,stroke:"none"}),!d&&O!=="scenes"&&e.jsx("path",{d:`M ${a.points[0].x} ${a.points[0].y} L ${a.points[1].x} ${a.points[1].y} L ${a.points[2].x} ${a.points[2].y} L ${a.points[3].x} ${a.points[3].y} Z`,fill:f.fill,fillOpacity:w,stroke:f.stroke,strokeWidth:a.id===s?2:1,strokeDasharray:"5,5"}),d&&(K==null?void 0:K.type)==="test"&&e.jsx(It,{wallPoints:a.points}),!d&&a.id===s&&O!=="scenes"&&a.points.map((E,V)=>e.jsx(Ge,{index:V,x:E.x,y:E.y,color:a.color,isSelected:!0,onDrag:(ce,ct,dt)=>De(a.id,ce,ct,dt),isMoveMode:k},`handle-${a.id}-${V}`)),v&&!d&&O!=="scenes"&&a.points.map((E,V)=>e.jsxs("text",{x:E.x+12,y:E.y+4,fill:"lime",fontSize:"9",fontFamily:"monospace",className:"pointer-events-none select-none shadow-black drop-shadow-md",style:{textShadow:"1px 1px 0 #000"},children:[" ",Math.round(E.x),",",Math.round(E.y)," "]},`guide-lbl-${V}`)),v&&!d&&O!=="scenes"&&e.jsxs("g",{pointerEvents:"none",children:[" ",e.jsx("line",{x1:a.points[0].x,y1:a.points[0].y,x2:a.points[2].x,y2:a.points[2].y,stroke:"cyan",strokeWidth:"1",strokeOpacity:"0.5",strokeDasharray:"4,4"})," ",e.jsx("line",{x1:a.points[1].x,y1:a.points[1].y,x2:a.points[3].x,y2:a.points[3].y,stroke:"cyan",strokeWidth:"1",strokeOpacity:"0.5",strokeDasharray:"4,4"})," "]})]},a.id)}),!d&&X&&O!=="scenes"&&X.points.map((a,h)=>e.jsx(Ge,{index:h,x:a.x,y:a.y,color:X.color,isSelected:!0,onDrag:(f,w,S)=>De(X.id,f,w,S),isMoveMode:k},`handle-${X.id}-${h}`))]});return e.jsxs("div",{className:"w-full h-full relative font-sans text-white bg-zinc-950 flex flex-col",children:[re&&e.jsx(_e,{}),!b&&e.jsx("div",{className:"absolute inset-0 z-[100] bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center text-center p-8",children:e.jsxs("div",{className:"max-w-4xl space-y-8",children:[e.jsx("img",{src:"/robotic T M.png",className:"w-[600px] mx-auto mb-8",alt:"Logo"}),e.jsx("h1",{className:"text-5xl font-bold text-white mb-4",children:"Emap"}),e.jsxs("button",{onClick:Qe,className:"bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-xl font-bold text-2xl flex items-center gap-3 mx-auto",children:[e.jsx(zt,{size:28})," Start"]})]})}),e.jsx(At,{isOpen:q,onClose:()=>U(!1),activeProjectId:Y,showConfirm:r,showAlert:x}),e.jsx(St,{isOpen:B.isOpen,onClose:()=>H({isOpen:!1}),onSelect:d=>{B.callback(d),H({isOpen:!1})},initialTab:B.type,showConfirm:r,showAlert:x}),e.jsx("div",{className:"absolute inset-0 h-full z-0",children:e.jsxs("div",{className:"absolute inset-0 z-10",onClick:()=>i(null),children:[e.jsx(Ot,{walls:p,currentCueState:T,isLive:y==="live",isTransitioning:C<1,shouldShow:O==="scenes"}),(y==="live"||O==="scenes")&&e.jsx(Pt,{prevCueState:$,currentCueState:T,mix:C,walls:p,isLive:y==="live"}),at(y==="live"),y==="2d"&&e.jsx("div",{className:"absolute top-4 left-4 pointer-events-none select-none drop-shadow-md z-50",children:O==="scenes"?e.jsxs("div",{className:"bg-black/50 px-3 py-2 rounded-lg backdrop-blur-sm",children:[e.jsx("div",{className:"text-xs text-purple-300 font-bold uppercase tracking-wider",children:"SCENE MODE"}),e.jsxs("div",{className:"text-lg font-bold text-white",children:["Act ",Ce+1," - Cue ",tt+1]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-xl font-bold tracking-wider text-white uppercase",children:"MAPPING STUDIO"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded font-mono border transition-colors ${k?"bg-orange-600 border-orange-400 text-white":"bg-zinc-800 border-zinc-600 text-gray-200"}`,children:"M: Move All"}),e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded font-mono border transition-colors ${v?"bg-blue-900 border-blue-500 text-blue-200":"bg-zinc-800 border-zinc-600 text-gray-200"}`,children:"G: Guides"}),e.jsx("span",{className:"text-xs bg-zinc-800 px-1.5 py-0.5 rounded text-gray-200 font-mono border border-zinc-600 uppercase",children:"H: Menu"})]})]})})]})}),O==="scenes"&&y!=="live"&&R&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[45%] z-30 border-t border-zinc-700/30 bg-zinc-900/50 backdrop-blur-md",children:A.cueId?e.jsx(e.Fragment,{children:A.type==="cue"?e.jsx(Dt,{activeSelection:A,currentCue:K,updateCueData:Pe,walls:p,setWalls:o,onOpenAssetBrowser:(d,a)=>H({isOpen:!0,type:d,callback:a})}):e.jsx(Lt,{cue:K,updateCue:Pe})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center backdrop-blur-sm bg-black/20",children:e.jsxs("div",{className:"text-center bg-zinc-900/80 p-8 rounded-2xl border border-zinc-800 shadow-2xl",children:[e.jsx(Be,{size:48,className:"text-purple-500 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-gray-400 font-bold mb-2 uppercase tracking-widest",children:"No Cue Selected"}),e.jsx("p",{className:"text-xs text-gray-500 max-w-[200px] mx-auto",children:"Please create or select an Act and a Cue in the sidebar to start mapping nodes."})]})})}),u&&y!=="live"&&e.jsxs("div",{className:"absolute right-4 top-4 bottom-4 w-64 bg-zinc-900/95 backdrop-blur border border-zinc-700 rounded-xl shadow-2xl z-50 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-4 pb-0",children:e.jsxs("button",{onClick:()=>{M("live"),m(!1)},className:"w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg shadow-lg flex items-center justify-center gap-2 transition-transform hover:scale-105",children:[e.jsx(We,{size:20,fill:"currentColor"})," GO LIVE"]})}),e.jsxs("div",{className:"p-4 border-b border-zinc-700 flex justify-between items-center bg-zinc-900",children:[e.jsxs("span",{className:"font-bold flex items-center gap-2",children:[" ",e.jsx(mt,{size:18})," Configuration "]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-white",children:"Ã"})]}),e.jsxs("div",{className:"flex border-b border-zinc-800 mt-4",children:[e.jsx("button",{onClick:()=>he("config"),className:`flex-1 py-2 text-xs font-bold ${O==="config"?"text-blue-400 border-b-2 border-blue-400":"text-gray-500 hover:text-gray-300"}`,children:"Geometry"}),e.jsx("button",{onClick:()=>he("scenes"),className:`flex-1 py-2 text-xs font-bold ${O==="scenes"?"text-purple-400 border-b-2 border-purple-400":"text-gray-500 hover:text-gray-300"}`,children:"Scenes"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[O==="config"&&e.jsxs(e.Fragment,{children:[y==="2d"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>N(d=>!d),className:`p-2 rounded text-xs flex items-center justify-center gap-1 border transition-colors ${k?"bg-orange-600 border-orange-400 text-white":"bg-zinc-800 border-zinc-700 text-gray-300"}`,children:[" ",e.jsx(jt,{size:14})," Move (M) "]}),e.jsxs("button",{onClick:()=>z(d=>!d),className:`p-2 rounded text-xs flex items-center justify-center gap-1 border transition-colors ${v?"bg-blue-900/50 border-blue-500 text-blue-200":"bg-zinc-800 border-zinc-700 text-gray-300"}`,children:[" ",e.jsx(yt,{size:14})," Guide (G) "]})]}),X&&e.jsxs("div",{className:"space-y-3 bg-zinc-900 border border-zinc-700 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-zinc-800",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:X.color}}),e.jsx("input",{type:"text",value:X.name,onChange:d=>o(a=>a.map(h=>h.id===X.id?{...h,name:d.target.value}:h)),className:"bg-transparent border-none outline-none text-sm font-bold text-white w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 flex items-center gap-1 mb-1",children:[e.jsx(we,{size:10})," Group"]}),e.jsx(je,{value:X.folderId||"",onChange:d=>o(a=>a.map(h=>h.id===X.id?{...h,folderId:d?parseInt(d):null}:h)),buttonClassName:"bg-zinc-800 border-zinc-700 px-2 py-1 text-xs",options:[{value:"",label:"None"},...c.map(d=>({value:d.id,label:d.name}))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-gray-500 flex items-center gap-1 mb-1",children:[e.jsx(ve,{size:10})," Color"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-zinc-800 border border-zinc-700 rounded px-2 py-0.5 h-7",children:[e.jsx(qe,{value:X.color,onChange:d=>o(a=>a.map(h=>h.id===X.id?{...h,color:d}:h)),className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-gray-400 font-mono",children:X.color})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500",children:"OBJECTS"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:lt,className:"text-xs bg-zinc-800 hover:bg-zinc-700 px-2 py-1 rounded flex items-center gap-1",title:"New Group",children:[" ",e.jsx(Mt,{size:12})," "]}),e.jsxs("button",{onClick:()=>{const d=Math.max(0,...p.map(a=>a.id))+1;o(a=>[...a,{id:d,name:`Obj ${d}`,color:`hsl(${Math.random()*360},70%,60%)`,folderId:null,points:[{x:300,y:300},{x:400,y:300},{x:400,y:400},{x:300,y:400}]}])},className:"text-xs bg-zinc-800 hover:bg-zinc-700 px-2 py-1 rounded flex items-center gap-1",title:"New Object",children:[" ",e.jsx(ye,{size:12})," "]})]})]}),c.map(d=>e.jsx(Rt,{folder:d,walls:p,activeWallId:s,setActiveWallId:i,setWalls:o,setFolders:l,moveWall:Fe,deleteWall:Le},d.id)),p.filter(d=>d.folderId===null).map(d=>e.jsx(Je,{wall:d,activeWallId:s,setActiveWallId:i,moveWall:Fe,deleteWall:Le},d.id))]}),e.jsx(Ft,{walls:p,activeWallId:s}),e.jsx("div",{className:"mt-4 pt-4 border-t border-zinc-700",children:e.jsxs("button",{onClick:()=>U(!0),className:"w-full bg-zinc-800 hover:bg-zinc-700 text-gray-300 py-2 rounded text-xs font-bold flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:14})," Manage Projects"]})})]}),O==="scenes"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 border-b border-zinc-800 pb-2 mb-2",children:e.jsxs("button",{onClick:()=>W(d=>!d),className:`w-full p-2 rounded text-xs flex items-center justify-center gap-1 border transition-colors ${R?"bg-purple-900/50 border-purple-500 text-purple-200":"bg-zinc-800 border-zinc-700 text-gray-300"}`,title:"Toggle Node Editor",children:[R?e.jsx(bt,{size:14}):e.jsx(gt,{size:14})," ",R?"Hide Graph":"Show Graph"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-400 uppercase",children:"Cue List"}),e.jsxs("button",{onClick:ot,className:"text-xs bg-purple-600 hover:bg-purple-500 px-2 py-1 rounded flex items-center gap-1 text-white ml-2",children:[e.jsx(ye,{size:12})," Act"]})]}),G.map((d,a)=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"px-2 py-1 text-xs font-bold text-gray-500 uppercase border-b border-zinc-800 mb-1 flex justify-between items-center",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Nt,{size:10})," ",d.name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>Te(a,-1),className:"text-gray-500 hover:text-white p-0.5",children:e.jsx(Me,{size:12})}),e.jsx("button",{onClick:()=>Te(a,1),className:"text-gray-500 hover:text-white p-0.5",children:e.jsx(xe,{size:12})}),e.jsx("button",{onClick:()=>nt(d.id),className:"text-gray-500 hover:text-red-400 p-0.5",title:"Delete Act",children:e.jsx(le,{size:12})}),e.jsx("button",{onClick:()=>it(d.id),className:"text-[9px] bg-zinc-800 hover:bg-zinc-700 px-1.5 py-0.5 rounded text-gray-300 ml-1",children:"+ Cue"})]})]}),e.jsx("div",{className:"space-y-0 pl-1",children:d.cues.map((h,f)=>{var F;const w=A.type==="cue"&&A.sceneId===d.id&&A.cueId===h.id,S=d.cues[f+1]||((F=G[a+1])==null?void 0:F.cues[0]);return e.jsxs("div",{children:[e.jsxs("div",{onClick:()=>g({type:"cue",sceneId:d.id,cueId:h.id}),className:`flex items-center gap-2 p-2 rounded text-xs cursor-pointer transition-all group ${w?"bg-purple-900/50 border-l-2 border-purple-400 text-white":"hover:bg-zinc-800 text-gray-400 border-l-2 border-transparent"}`,children:[w?e.jsx(We,{size:10,fill:"currentColor"}):e.jsx("span",{className:"w-2.5"}),e.jsx("span",{className:"truncate flex-1",children:h.name}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:E=>{E.stopPropagation(),moveCue(d.id,f,-1)},className:"text-gray-500 hover:text-white p-0.5",children:e.jsx(Me,{size:10})}),e.jsx("button",{onClick:E=>{E.stopPropagation(),moveCue(d.id,f,1)},className:"text-gray-500 hover:text-white p-0.5",children:e.jsx(xe,{size:10})}),e.jsx("button",{onClick:E=>{E.stopPropagation(),rt(d.id,h.id)},className:"text-gray-500 hover:text-red-400 p-0.5",title:"Delete Cue",children:e.jsx(le,{size:10})})]})]}),S&&e.jsx("div",{className:`h-2 my-0.5 rounded-full mx-2 cursor-pointer hover:bg-purple-500/50 transition-colors group relative flex justify-center items-center ${A.type==="transition"&&A.nextCueId===S.id?"bg-purple-500":"bg-zinc-800"}`,onClick:()=>g({type:"transition",sceneId:d.id,prevCueId:h.id,nextCueId:S.id}),children:e.jsx("div",{className:"w-3 h-3 rounded-full bg-zinc-600 border border-zinc-900 group-hover:bg-white group-hover:scale-125 transition-transform flex items-center justify-center",children:e.jsx(Xe,{size:8,className:"text-zinc-900"})})})]},h.id)})})]},d.id))]})]})]})]}),e.jsx(Wt,{...t,onCancel:()=>n(d=>({...d,isOpen:!1}))})]})}xt.createRoot(document.getElementById("root")).render(e.jsx(ut.StrictMode,{children:e.jsx(Gt,{})}));
